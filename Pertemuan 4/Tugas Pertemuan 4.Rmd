---
output: 
  html_document:
    css: "D:\\Nada\\Nada Kuliah\\Template CSS\\baru.css"
    toc: true
    toc_float: true
    number_sections: false
    theme: flatly
    highlight: tango
---

```{r,echo=FALSE, results='asis'}
cat('
<div style="position: fixed; bottom: 10px; left: 50px; color: #1C2A1A; font-weight: bold;">
  Nada Ardelia <br>
  G1401231011 <br>
</div>
')
```


# White Noise

White Noise dibangkitkan dari peubah acak (set seed 4 digit akhir NIM)

```{r}
set.seed(1011)
wn <- rnorm(300)
ts.plot(wn)
```

```{r}
par(mfrow = c(1, 2)) 
acf(wn)
acf(wn, xlim = c(1, 20))
```
Dapat dilihat bahwa white noise tidak memiliki autokorelasi dari plot ACF.


# MA(2)

\[
y_t = c + e_t + \theta_1 e_{t-1} + \theta_2 e_{t-2}
\] 

## Model

Akan dibangkitkan proses MA(2) dengan \theta_1 = 0,4\ dan \theta_2 = 0,6\ sebanyak 300 observasi dan \c = 0\ 

```{r}
set.seed(1011)
ma <- rep(0, 300)
```


\[
y_t = e_t + 0.4 e_{t-1} + 0.6 e_{t-2}
\]

Nilai-nilai \(y_t\) selanjutnya dapat dicari melalui *loop* berdasarkan rumus di atas.

```{r}
for(i in 3:300){
  ma[i] <- wn[i] + 0.4*wn[i-1] + 0.6*wn[i-2]
}

ma
```

Selain secara manual, pembangkita model MA(2) juga dapat dilakukan dengan fungsi arima.sim() sebagai berikut.

```{r}
ma2 <- arima.sim(list(order = c(0, 0, 2), ma = c(0.4, 0.6)), n = 300)

ma2
```


## Plot

### Plot Time Series

```{r}
ts.plot(ma)
```

Berdasarkan plot time series, data MA(2) yang dibangkitkan stasioner terhadap rataan.


### Plot ACF

```{r}
acf(ma,lag.max = 20)
```

Berdasarkan plot ACF tersebut, terlihat bahwa plot ACF cuts off di lag 2.

### Plot PACF

```{r}
pacf(ma)
```

Berdasarkan plot PACF tersebut, terlihat bahwa plot PACF cenderung tails off.

### Plot EACF

```{r}
TSA::eacf(ma)
```
Berdasarkan pola segitiga nol pada plot EACF, terlihat bahwa segitiga nol berada pada ordo AR(0) dan ordo MA(2).


## Scatter Plot

### Korelasi Y_t dengan Y_t-1

```{r}
# Yt
yt_ma <- ma[-1]
yt_ma
```

```{r}
# Yt-1
yt_1_ma <- ma[-300]
yt_1_ma
```

```{r}
plot(y=yt_ma,x=yt_1_ma)
```
Berdasarkan scatterplot tersebut, terlihat bahwa terdapat hubungan positif antara \Y_{t}\ dengan \Y{t−1}\ .

```{r}
cor(yt_ma,yt_1_ma)
```
Korelasi antara \(Y_t\) dengan \(Y_{t-1}\) dan \(Y_{t-2}\) dari hasil simulasi dapat dibandingkan dengan perhitungan teoretis berikut:

\[
\rho_1 = \frac{\theta_1 + \theta_1 \theta_2}{1 + \theta_1^2 + \theta_2^2} =
\frac{0{,}4 + (0{,}4)(0{,}6)}{1 + (0{,}4)^2 + (0{,}6)^2} =
\frac{0{,}64}{1 + 0{,}16 + 0{,}36} =
\frac{0{,}64}{1{,}52} \approx 0{,}421
\]

Nilai korelasi empiris berbeda dengan teoritis karena hasil simulasi itu bersifat acak, jadi nilai korelasi empiris (dari data hasil simulasi) tidak selalu identik dengan nilai teoretis.

### Korelasi Y_t dengan Y_t-2

```{r}
#Yt
yt_ma2 <- ma[-c(1,2)]
yt_ma2
```

```{r}
#Yt-2
yt_2_ma <- ma[-c(299,300)]
yt_2_ma
```

```{r}
plot(y=yt_ma2,x=yt_2_ma)
```

Berdasarkan scatterplot tersebut, terlihat bahwa terdapat hubungan positif antara \Y_{t}\ dengan \Y{t−2}\ .

```{r}
cor(yt_ma2,yt_2_ma)
```

\[
\rho_2 = \frac{\theta_2}{1 + \theta_1^2 + \theta_2^2} =
\frac{0{,}6}{1 + (0{,}4)^2 + (0{,}6)^2} =
\frac{0{,}6}{1 + 0{,}16 + 0{,}36} =
\frac{0{,}6}{1{,}52} \approx 0{,}395
\]


Nilai korelasi empiris berbeda dengan teoritis karena hasil simulasi itu bersifat acak, jadi nilai korelasi empiris (dari data hasil simulasi) tidak selalu identik dengan nilai teoretis.

### Korelasi Y_t dengan Y_t-3

```{r}
#Yt
yt_ma3 <- ma[-c(1,2,3)]
yt_ma3
```

```{r}
#Yt-3
yt_3_ma <- ma[-c(298,299,300)]
yt_3_ma
```

```{r}
plot(y=yt_ma3,x=yt_3_ma)
```

Berdasarkan scatterplot tersebut, terlihat bahwa cenderung tidak terdapat hubungan antara \Y_{t}\ dengan \Y{t−3}\ .

```{r}
cor(yt_ma3,yt_3_ma)
```
Korelasi antara \Y_{t}\ dengan \Y{t−3}\ hasil simulasi mendekati teori yang ada, yaitu 0.


# AR(2)

## Proses AR

Proses AR dapat dituliskan sebagai berikut:

\[
y_t = c + e_t + \phi_1 Y_{t-1} + \phi_2 Y_{t-2} + \cdots + \phi_q Y_{t-q}
= c + e_t + \sum_{i=1}^{p} \phi_i Y_{t-i}
\]

Terlihat bahwa \(Y_t\) berperan penting dalam pembangkitan proses AR.


## Model

Akan dicoba membangkitkan proses AR(2) dengan \phi_{1} = 0,5\ dan \phi_{2} = 0,2\ sebanyak 300 observasi dan c = 0.

```{r}
set.seed(1011)
```

Nilai-nilai selanjutnya dapat dicari melalui *loop*. Bentuk *loop* dapat dilihat dari rumus AR(2) yang akan dibangkitkan:

\[
Y_t = e_t + 0{,}5 Y_{t-1} + 0{,}2 Y_{t-2}
\]


```{r}
n <- 300
wn <- rnorm(n)
```

```{r}
# Bangkitkan AR(2) manual
ar2 <- rep(0, n)

for (i in 3:n) {
  ar2[i] <- wn[i] + 0.5 * ar2[i - 1] + 0.2 * ar2[i - 2]
}

ar2
```
Selain menggunakan cara di atas, pembangkitan proses AR dapat dilakukan dengan fungsi arima.sim() sebagai berikut.

```{r}
ar2_sim <- arima.sim(list(order = c(2, 0, 0), ar = c(0.5, 0.2)), n = 300)

ar2_sim
```


## Plot

### Plot Time Series

```{r}
ts.plot(ar2)
```

Berdasarkan plot time series tersebut terlihat bahwa data cenderung stasioner pada rataan.

### Plot ACF

```{r}
acf(ar2)
```
Berdasarkan plot ACF tersebut terlihat bahwa plot ACF cenderung tails off.

### Plot PACF

```{r}
pacf(ar2)
```

Berdasarkan plot PACF tersebut, terlihat bahwa plot PACF cuts off pada lag 2, sejalan dengan teori yang ada.

### Plot EACF

```{r}
TSA::eacf(ar2)
```
Hasil plot EACF menyarankan model ARMA(2,2), padahal data dibangkitkan dari AR(2). Hal ini wajar terjadi karena data simulasi yang bersifat acak, jadi hasil EACF tidak selalu tepat.

## Scatter Plot

### Korelasi Y_t dengan Y_t-1

```{r}
#Yt
yt_ar <- ar2[-1]
yt_ar
```

```{r}
#Yt-1
yt_1_ar <- ar2[-300]
yt_1_ar
```

```{r}
plot(y=yt_ar,x=yt_1_ar)
```
Berdasarkan scatterplot tersebut, terlihat bahwa terdapat hubungan positif antara \Y_{t}\ dengan \Y_{t−1}\.

```{r}
cor(yt_ar,yt_1_ar)
```
Korelasi antara \Y_{t}\ dengan \Y_{t−1}\ dari hasil simulasi mendekati perhitungan teoritis, yaitu

\[
\rho_1 = \frac{\phi_1}{1 - \phi_2} = \frac{0{,}5}{1 - 0{,}2} = \frac{0{,}5}{0{,}8} = 0{,}625
\]


### Korelasi Y_t dengan Y_t-2

```{r}
#Yt
yt_ar2 <- ar2[-c(1,2)]
yt_ar2
```

```{r}
#Yt-2
yt_2_ar <- ar2[-c(299,300)]
yt_2_ar
```

```{r}
plot(y=yt_ar2,x=yt_2_ar)
```

Berdasarkan scatterplot tersebut, terlihat bahwa terdapat hubungan positif antara \Y_{t}\ dengan \Y_{t−2}\.

```{r}
cor(yt_ar2,yt_2_ar)
```
Korelasi antara \Y_{t}\ dengan \Y_{t−2}\ dari hasil simulasi mendekati perhitungan teoritis, yaitu

\[
\rho_2 = \phi_1 \cdot \rho_1 + \phi_2 = (0{,}5)(0{,}625) + 0{,}2 = 0{,}3125 + 0{,}2 = 0{,}5125
\]


### Korelasi Y_t dengan Y_t-3

```{r}
#Yt
yt_ar3 <- ar2[-c(1,2,3)]
yt_ar3
```
```{r}
#Yt-3
yt_3_ar <- ar2[-c(298,299,300)]
yt_3_ar
```

```{r}
plot(y=yt_ar3,x=yt_3_ar)
```
Berdasarkan scatterplot tersebut, terlihat bahwa terdapat hubungan positif antara \Y_{t}\ dengan \Y_{t−3}\.

```{r}
cor(yt_ar3,yt_3_ar)
```
Korelasi antara \(Y_t\) dan \(Y_{t-3}\) dari model AR(2) dihitung menggunakan rumus rekursif Yule-Walker:

\[
\rho_3 = \phi_1 \cdot \rho_2 + \phi_2 \cdot \rho_1
= (0{,}5)(0{,}5125) + (0{,}2)(0{,}625)
= 0{,}25625 + 0{,}125
= 0{,}38125
\]

Nilai korelasi empiris berbeda dengan teoritis karena hasil simulasi itu bersifat acak, jadi nilai korelasi empiris (dari data hasil simulasi) tidak selalu identik dengan nilai teoretis.


# ARMA(2,2)

Model ARMA(2,2) merupakan gabungan dari model autoregressive (AR) orde 2 dan moving average (MA) orde 2. Bentuk umum model ARMA adalah sebagai berikut:

$$
y_t = c + \sum_{i=1}^{p} \phi_i y_{t-i} + \sum_{j=1}^{q} \theta_j e_{t-j} + e_t
$$

Sebagai contoh, jika diketahui parameter:

- $\phi_1 = 0.5$
- $\phi_2 = 0.2$
- $\theta_1 = 0.4$
- $\theta_2 = 0.6$

Maka model ARMA(2,2) menjadi:

$$
y_t = c + 0.5\,y_{t-1} + 0.2\,y_{t-2} + 0.4\,e_{t-1} + 0.6\,e_{t-2} + e_t
$$

Untuk menghitung bagian AR dan MA:

Koefisien AR:
$$
[\phi_1\ \phi_2] = [0.5\ \ 0.2]
$$

Lag data sebelumnya:
$$
[y_{t-1}\ \ y_{t-2}] = [2\ \ 3]
$$

Maka bagian AR:
$$
0.5 \cdot 2 + 0.2 \cdot 3 = 1.0 + 0.6 = 1.6
$$

Begitu pula bagian MA, jika diketahui:
$$
[\theta_1\ \theta_2] = [0.4\ \ 0.6] \quad \text{dan} \quad [e_{t-1}\ \ e_{t-2}] = [1\ \ 2]
$$

Maka:
$$
0.4 \cdot 1 + 0.6 \cdot (2) = 1.6
$$

Sehingga nilai $y_t$ (tanpa e baru dan c):
$$
y_t = 1.6 + 1.6 = 3.2
$$


## Model

```{r}
set.seed(1011)
n <- 300
phi <- c(0.5, 0.2)        # AR(2)
theta <- c(0.4, 0.6)      # MA(2)
```

```{r}
phi <- c(0.5, 0.2)
y_lag <- c(2, 3)

# perkalian matriks
phi %*% y_lag

# perkalian element-wise
phi * y_lag
sum(phi * y_lag)
```

```{r}
theta <- c(0.4, 0.6)
wn_lag <- c(1, 2)

# komponen MA
sum(theta * wn_lag)

```

```{r}
sum(phi * y_lag) + sum(theta * wn_lag)
```
Dari prinsip ini, dapat dibuat fungsi umum untuk membangkitkan data ARMA. Input dari fungsi adalah jumlah data yang akan dibangkitkan, koefisien MA, dan koefisien AR.


```{r}
# Fungsi untuk membangkitkan data ARMA(p,q)
arma.sim <- function(n, macoef, arcoef){
  manum <- length(macoef)
  arnum <- length(arcoef)
  stopifnot(manum < n & arnum < n)

  wn <- rnorm(n, sd = 0.5)
  init <- max(manum, arnum)

  arma <- wn[1:init]
  for(i in (init+1):n){
    mastart <- i - manum
    maend <- i - 1
    arstart <- i - arnum
    arend <- i - 1
    arma[i] <- sum(arcoef * arma[arstart:arend]) + sum(macoef * wn[mastart:maend]) + wn[i]
  }
  return(arma)
}
```


*Model ARMA(2,2) Manual*

```{r}
set.seed(1011)
n <- 300
wn <- rnorm(n)

phi1 <- 0.5
phi2 <- 0.2
theta1 <- 0.4
theta2 <- 0.6

y.arma <- rep(0, n)

for (i in 3:n){
  y.arma[i] <- phi1*y.arma[i-1] + phi2*y.arma[i-2] +
               theta1*wn[i-1] + theta2*wn[i-2] + wn[i]
}

head(y.arma)

```

*Model ARMA(2,2) arma.sim*

```{r}
# Simulasi ARMA(2,2) dengan arma.sim
set.seed(1011)

arma22 <- arma.sim(
  n = 300, 
  macoef = c(0.4, 0.6), 
  arcoef = c(0.5, 0.2)
)

# Estimasi model ARMA(2,2)
arma22 |> arima(order = c(2,0,2))

```

```{r}
arma_22 <- arima.sim(list(order=c(2,0,2), ar = c(0.5, 0.2), ma = c(0.4, 0.6)), n=300)
arma_22
```

## Plot

### Plot Time Series

```{r}
ts.plot(y.arma, main = "Simulasi ARMA(2,2)", ylab = "y.arma", xlab = "Time")

ts.plot(arma_22, main = "Simulasi ARMA(2,2)", ylab = "arma_22", xlab = "Time")
```

Berdasarkan plot time series tersebut, terlihat bahwa model ARMA(2,2) cenderung stasioner dalam rataan.


### Plot ACF

```{r}
par(mfrow = c(1,2))
acf(y.arma, lag.max = 20, main = "ACF ARMA(2,2)")
```
Berdasarkan plot ACF tersebut, terlihat bahwa model ARMA(2,2) hasil simulasi memiliki plot ACF yang tails off, sesuai dengan teori yang ada.

### Plot PACF

```{r}
pacf(y.arma, lag.max = 20, main = "PACF ARMA(2,2)")
```
Berdasarkan plot PACF tersebut, terlihat bahwa model ARMA(2,2) hasil simulasi memiliki plot PACF yang tails off, sesuai dengan teori.


### Plot EACF

```{r}
TSA::eacf(y.arma)
```

```{r}
TSA::eacf(arma_22)
```
Berdasarkan pola segitiga nol pada plot EACF, tidak jelas terlihat bahwa segitiga nol berada pada ordo AR(2) dan ordo MA(2).

## Scatter Plot

### Korelasi Y_t dengan Y_t-1

```{r}
#Yt
yt_arma <- arma_22[-1]
yt_arma
```

```{r}
#Yt-1
yt_1_arma <- arma_22[-300]
yt_1_arma
```
```{r}
plot(y=yt_arma,x=yt_1_arma)
```

Berdasarkan scatterplot tersebut, terlihat bahwa terdapat hubungan positif antara \Y_{t}\ dengan \Y_{t−1}\.

```{r}
cor(yt_arma,yt_1_arma)
```
Korelasi antara \Y_{t}\ dengan \Y_{t−1}\ dari hasil simulasi mendekati perhitungan teoritis:

Untuk model ARMA(2,2) dengan parameter 
\(\phi_1 = 0.5, \phi_2 = 0.2, \theta_1 = 0.4, \theta_2 = 0.6\), 


\[
Y_t = \sum_{j=0}^{\infty} \psi_j \, \varepsilon_{t-j}
\]

dengan koefisien \(\psi_j\) memenuhi rekursi:

\[
\psi_0 = 1, \quad 
\psi_k = \theta_k + \phi_1 \psi_{k-1} + \phi_2 \psi_{k-2}, \quad k \ge 1,
\]

dengan \(\theta_1 = 0.4, \theta_2 = 0.6, \theta_k = 0\) untuk \(k > 2\).

---

Langkah perhitungan koefisien \(\psi_j\):

\[
\begin{aligned}
\psi_0 &= 1 \\
\psi_1 &= 0.4 + 0.5(1) = 0.9 \\
\psi_2 &= 0.6 + 0.5(0.9) + 0.2(1) = 1.25 \\
\psi_3 &= 0.5(1.25) + 0.2(0.9) = 0.805 \\
\psi_4 &= 0.5(0.805) + 0.2(1.25) = 0.6525 \\
\vdots & 
\end{aligned}
\]

---

Autokovarians teoretis:

\[
\gamma_k = \sigma^2 \sum_{j=0}^{\infty} \psi_j \psi_{j+k}, \quad k \ge 0
\]

\[
\rho_k = \frac{\gamma_k}{\gamma_0}
\]


\[
\begin{aligned}
\rho_1 &\approx 0.859 \\
\end{aligned}
\]


### Korelasi Y_t dengan Y_t-2

```{r}
#Yt
yt_arma2 <- arma_22[-c(1,2)]
yt_arma2
```

```{r}
#Yt-2
yt_2_arma <- arma_22[-c(299,300)]
yt_2_arma
```

```{r}
plot(y=yt_arma2,x=yt_2_arma)
```

Berdasarkan scatterplot tersebut, terlihat bahwa terdapat hubungan positif antara \Y_{t}\ dengan \Y_{t−2}\.

```{r}
cor(yt_arma2,yt_2_arma)
```
Korelasi antara \Y_{t}\ dengan \Y_{t−2}\ dari hasil simulasi mendekati perhitungan teoritis:

Untuk model ARMA(2,2) dengan parameter 
\(\phi_1 = 0.5, \phi_2 = 0.2, \theta_1 = 0.4, \theta_2 = 0.6\), 


\[
Y_t = \sum_{j=0}^{\infty} \psi_j \, \varepsilon_{t-j}
\]

dengan koefisien \(\psi_j\) memenuhi rekursi:

\[
\psi_0 = 1, \quad 
\psi_k = \theta_k + \phi_1 \psi_{k-1} + \phi_2 \psi_{k-2}, \quad k \ge 1,
\]

dengan \(\theta_1 = 0.4, \theta_2 = 0.6, \theta_k = 0\) untuk \(k > 2\).

---

Langkah perhitungan koefisien \(\psi_j\):

\[
\begin{aligned}
\psi_0 &= 1 \\
\psi_1 &= 0.4 + 0.5(1) = 0.9 \\
\psi_2 &= 0.6 + 0.5(0.9) + 0.2(1) = 1.25 \\
\psi_3 &= 0.5(1.25) + 0.2(0.9) = 0.805 \\
\psi_4 &= 0.5(0.805) + 0.2(1.25) = 0.6525 \\
\vdots & 
\end{aligned}
\]

---

Autokovarians teoretis:

\[
\gamma_k = \sigma^2 \sum_{j=0}^{\infty} \psi_j \psi_{j+k}, \quad k \ge 0
\]

\[
\rho_k = \frac{\gamma_k}{\gamma_0}
\]


\[
\begin{aligned}
\rho_2 &\approx 0.749\\
\end{aligned}
\]



### Korelasi Y_t dengan Y_t-3

```{r}
#Yt
yt_arma3 <- arma_22[-c(1,2,3)]
yt_arma3
```

```{r}
#Yt-3
yt_3_arma <- arma_22[-c(298,299,300)]
yt_3_arma
```

```{r}
plot(y=yt_arma3,x=yt_3_arma)
```

Berdasarkan scatterplot tersebut, terlihat bahwa terdapat hubungan positif antara \Y_{t}\ dengan \Y_{t−3}\.

```{r}
cor(yt_arma3,yt_3_arma)
```
Korelasi antara \Y_{t}\ dengan \Y_{t−1}\ dari hasil simulasi mendekati perhitungan teoritis:

Untuk model ARMA(2,2) dengan parameter 
\(\phi_1 = 0.5, \phi_2 = 0.2, \theta_1 = 0.4, \theta_2 = 0.6\), 


\[
Y_t = \sum_{j=0}^{\infty} \psi_j \, \varepsilon_{t-j}
\]

dengan koefisien \(\psi_j\) memenuhi rekursi:

\[
\psi_0 = 1, \quad 
\psi_k = \theta_k + \phi_1 \psi_{k-1} + \phi_2 \psi_{k-2}, \quad k \ge 1,
\]

dengan \(\theta_1 = 0.4, \theta_2 = 0.6, \theta_k = 0\) untuk \(k > 2\).

---

Langkah perhitungan koefisien \(\psi_j\):

\[
\begin{aligned}
\psi_0 &= 1 \\
\psi_1 &= 0.4 + 0.5(1) = 0.9 \\
\psi_2 &= 0.6 + 0.5(0.9) + 0.2(1) = 1.25 \\
\psi_3 &= 0.5(1.25) + 0.2(0.9) = 0.805 \\
\psi_4 &= 0.5(0.805) + 0.2(1.25) = 0.6525 \\
\vdots & 
\end{aligned}
\]

---

Autokovarians teoretis:

\[
\gamma_k = \sigma^2 \sum_{j=0}^{\infty} \psi_j \psi_{j+k}, \quad k \ge 0
\]

\[
\rho_k = \frac{\gamma_k}{\gamma_0}
\]


\[
\begin{aligned}
\rho_3 &\approx 0.546\\
\end{aligned}
\]

